services:    
  # Training service - trains the model using downloaded data
  trainer:
    build: .
    container_name: smart_grid_trainer
    
    env_file:
      - .env
    
    volumes:
      - ./src:/app/src
      - ./data:/app/data
        
    # Train using data from /app/data/downloads
    command: python train.py --epochs 50 --batch-size 32
    
    # Don't restart after training completes
    restart: "no"
    
  # Web service - runs the Flask app
  app:
    build: .
    container_name: smart_grid_app
    
    env_file:
      - .env
    
    volumes:
      - ./src:/app/src
      - ./data:/app/data
    
    ports:
      - "8000:8000"
    
    command: python -u app.py
    
    # Keep app running
    restart: unless-stopped